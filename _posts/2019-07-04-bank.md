---
layout:     post
title:      Bank System
author:     "Shane"
excerpt:    ""
header-img: "img/bg-mac.jpg"
tags:
    - OOD
---

### Requiremnt
1. cross bank transfer
2. depoist
3. Withdraw

```java
// ignore all of CURD operation

Interface PersonalInterestStrategy {

    void deposit(PersonalAccount user, int price);

    void withdraw(PersonalAccount user, int price);
}

Class PersonalAccount {
    int userID;
    int fund;
    String accountType;
    // 使用PersonalAccountFactory 根据accountType进行初始化
    PersonalInterestStrategy personalInterestStrategy;

    void deposit(int price){
        personalInterestStrategy.deposit(this, price);
    }

    void withdraw(int price){
        personalInterestStrategy.withdraw(this, price);
    }
}

// the subclass of Parter should be annoted with @Component. They are all singlton.
AbstractClass Partner {
    Chase chase;
    int bankID;
    int fund;

    notifyAdd(PersonalAccount fromUser, NotChaseUser toUser, int price);
}

Class NotChaseUser {
    int bankID;
    int userID;
}

// @Component
Class Chase{

    int fund;
    void addFundToUser(PersonalAccount user, int price);
}

// @Component
Interface PartnerFactory {
    Bank getBankByID(int id);
}

// set the strategy pattern by user's account type
// @Component
Interface PersonalAccountFactory {
    PersonalAccount getPersonalAccountByID(int id);
}

// @Component
Interface NotChaseUserFactory {
    NotChaseUser getNotChaseUser(NotChaseUserVO toUserVO);
}

// app controller
Class Controller {

    PartnerFactory partnerFactory;
    PersonalAccountFactory personalAccountFactory;
    NotChaseUserFactory notChaseUserFactory
    Chase chase;

    void depoist(PersonalAccountVO userVO, int price) throws Exception{
        PersonalAccount user = personalFactory.getPersonalAccountByID(userVO.getID());
        user.deposit(price);
    }

    void withdraw(PersonalAccountVO user, int price) throws Exception{
        PersonalAccount user = personalFactory.getPersonalAccountByID(userVO.getID());
        user.withdraw(price);
    }

    // toUser不存在数据库里, 直接使用VO的数据
    void crossBankTransfer(PersonalAccountVO fromUserVO, NotChaseUserVO toUserVO, int price) throws Exception {
        PersonalAccount fromUser = personalFactory.getPersonalAccountByID(fromUserVO.getID());
        NotChaseUser toUser = personalAccountFactgetNotChaseUser(toUserVO);
        Partner toBank = partnerFactory.getBankByID(toUser.getBankID());
        // notify the toBank to sudo add fund into toUser's account
        toBank.notifyAdd(toUser, fromUser, price);
        chase.addFundToUser(fromUser, -price);
    }
}
```